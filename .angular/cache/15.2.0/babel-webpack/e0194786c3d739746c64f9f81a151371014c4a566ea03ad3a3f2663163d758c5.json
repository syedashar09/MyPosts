{"ast":null,"code":"import { Subject } from \"rxjs\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nexport class AuthService {\n  constructor(http, router) {\n    this.http = http;\n    this.router = router;\n    this.url = \"http://localhost:3000/api/user/\";\n    this.IsAuthenticated = false;\n    this.authStatusListener = new Subject();\n  }\n  getAuthStatusListener() {\n    return this.authStatusListener.asObservable();\n  }\n  getIsAuth() {\n    return this.IsAuthenticated;\n  }\n  getAuthToken() {\n    return this.AuthToken;\n  }\n  getUserId() {\n    return this.userId;\n  }\n  CreateUser(email, username, password) {\n    const AuthData = {\n      email: email,\n      username: username,\n      password: password\n    };\n    this.http.post(this.url + \"signup\", AuthData).subscribe(Response => {\n      console.log(Response);\n    }, error => {\n      this.authStatusListener.next(false);\n    });\n  }\n  logInUser(email, password) {\n    const AuthData = {\n      email: email,\n      password: password,\n      username: null\n    };\n    this.http.post(\"http://localhost:3000/api/user/login\", AuthData).subscribe(Response => {\n      const token = Response.token;\n      const userId = Response.userId;\n      this.AuthToken = token;\n      this.userId = userId;\n      if (Response.token) {\n        const expiresInDuration = Response.expiresIn;\n        this.setAuthTimer(expiresInDuration);\n        const now = new Date();\n        const expirationTime = new Date(now.getTime() + expiresInDuration * 1000);\n        console.log(expirationTime);\n        console.log(expiresInDuration);\n        this.saveAuthData(token, expirationTime, userId);\n        this.IsAuthenticated = true;\n        this.authStatusListener.next(true);\n        console.log(Response.token);\n      }\n    });\n    this.router.navigate([\"/\"]);\n  }\n  logOutUser() {\n    this.AuthToken = null;\n    this.IsAuthenticated = false;\n    this.userId = null;\n    this.authStatusListener.next(false);\n    clearTimeout(this.tokenTimer);\n    this.clearAuthData();\n    this.router.navigate([\"/\"]);\n  }\n  autoAuthUser() {\n    const authInformation = this.getAuthInfo();\n    if (!authInformation) return;\n    const now = new Date();\n    const expiresIn = authInformation.expirationDate.getTime() - now.getTime();\n    if (expiresIn > 0) {\n      this.AuthToken = authInformation.token;\n      this.IsAuthenticated = true;\n      this.userId = authInformation.userId;\n      this.authStatusListener.next(true);\n      this.setAuthTimer(expiresIn / 1000);\n      console.log(expiresIn);\n    }\n  }\n  setAuthTimer(duration) {\n    this.tokenTimer = setTimeout(() => {\n      this.logOutUser();\n    }, duration * 1000);\n    console.log(\"Setting timer: \" + duration);\n  }\n  saveAuthData(token, duration, userId) {\n    localStorage.setItem(\"token\", token);\n    localStorage.setItem(\"expiration\", duration.toISOString());\n    localStorage.setItem(\"userId\", userId);\n  }\n  getAuthInfo() {\n    const token = localStorage.getItem(\"token\");\n    const expirationDate = localStorage.getItem(\"expiration\");\n    const userId = localStorage.getItem(\"userId\");\n    if (!token || !expirationDate) {\n      return null;\n    }\n    return {\n      token: token,\n      expirationDate: new Date(expirationDate),\n      userId: userId\n    };\n  }\n  clearAuthData() {\n    localStorage.removeItem(\"token\");\n    localStorage.removeItem(\"expiration\");\n    localStorage.removeItem(\"userId\");\n  }\n}\nAuthService.ɵfac = function AuthService_Factory(t) {\n  return new (t || AuthService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.Router));\n};\nAuthService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: AuthService,\n  factory: AuthService.ɵfac,\n  providedIn: \"root\"\n});","map":{"version":3,"mappings":"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","names":["Subject","AuthService","constructor","http","router","getAuthStatusListener","authStatusListener","asObservable","getIsAuth","IsAuthenticated","getAuthToken","AuthToken","getUserId","userId","CreateUser","email","username","password","AuthData","post","url","subscribe","Response","console","log","error","next","logInUser","token","expiresInDuration","expiresIn","setAuthTimer","now","Date","expirationTime","getTime","saveAuthData","navigate","logOutUser","clearTimeout","tokenTimer","clearAuthData","autoAuthUser","authInformation","getAuthInfo","expirationDate","duration","setTimeout","localStorage","setItem","toISOString","getItem","removeItem","factory","providedIn"],"sourceRoot":"","sources":["C:\\Projects\\myPosts\\src\\app\\Auth\\auth.service.ts"],"sourcesContent":["import { HttpClient } from \"@angular/common/http\";\nimport { Injectable } from \"@angular/core\";\nimport { Router } from \"@angular/router\";\nimport { catchError, Subject } from \"rxjs\";\nimport { AuthData } from \"./auth.Model\";\n\n@Injectable({\n\tprovidedIn: \"root\",\n})\nexport class AuthService {\n\tprivate url = \"http://localhost:3000/api/user/\";\n\tprivate AuthToken: string;\n\tprivate IsAuthenticated = false;\n\tprivate userId: string;\n\tprivate authStatusListener = new Subject<boolean>();\n\tprivate tokenTimer: any;\n\n\tconstructor(private http: HttpClient, private router: Router) {}\n\n\tgetAuthStatusListener() {\n\t\treturn this.authStatusListener.asObservable();\n\t}\n\n\tgetIsAuth() {\n\t\treturn this.IsAuthenticated;\n\t}\n\tgetAuthToken() {\n\t\treturn this.AuthToken;\n\t}\n\tgetUserId() {\n\t\treturn this.userId;\n\t}\n\n\tCreateUser(email: string, username: string, password: string) {\n\t\tconst AuthData: AuthData = {\n\t\t\temail: email,\n\t\t\tusername: username,\n\t\t\tpassword: password,\n\t\t};\n\t\tthis.http.post(this.url + \"signup\", AuthData).subscribe(\n\t\t\tResponse => {\n\t\t\t\tconsole.log(Response);\n\t\t\t},\n\t\t\terror => {\n\t\t\t\tthis.authStatusListener.next(false);\n\t\t\t}\n\t\t);\n\t}\n\n\tlogInUser(email: string, password: string) {\n\t\tconst AuthData: AuthData = { email: email, password: password, username: null };\n\n\t\tthis.http\n\t\t\t.post<{ token: string; expiresIn: number; userId: string }>(\n\t\t\t\t\"http://localhost:3000/api/user/login\",\n\t\t\t\tAuthData\n\t\t\t)\n\t\t\t.subscribe(Response => {\n\t\t\t\tconst token = Response.token;\n\t\t\t\tconst userId = Response.userId;\n\t\t\t\tthis.AuthToken = token;\n\t\t\t\tthis.userId = userId;\n\t\t\t\tif (Response.token) {\n\t\t\t\t\tconst expiresInDuration = Response.expiresIn;\n\t\t\t\t\tthis.setAuthTimer(expiresInDuration);\n\t\t\t\t\tconst now = new Date();\n\t\t\t\t\tconst expirationTime = new Date(now.getTime() + expiresInDuration * 1000);\n\t\t\t\t\tconsole.log(expirationTime);\n\t\t\t\t\tconsole.log(expiresInDuration);\n\t\t\t\t\tthis.saveAuthData(token, expirationTime, userId);\n\t\t\t\t\tthis.IsAuthenticated = true;\n\t\t\t\t\tthis.authStatusListener.next(true);\n\t\t\t\t\tconsole.log(Response.token);\n\t\t\t\t}\n\t\t\t});\n\t\tthis.router.navigate([\"/\"]);\n\t}\n\tlogOutUser() {\n\t\tthis.AuthToken = null;\n\t\tthis.IsAuthenticated = false;\n\t\tthis.userId = null;\n\t\tthis.authStatusListener.next(false);\n\t\tclearTimeout(this.tokenTimer);\n\t\tthis.clearAuthData();\n\t\tthis.router.navigate([\"/\"]);\n\t}\n\n\tautoAuthUser() {\n\t\tconst authInformation = this.getAuthInfo();\n\t\tif (!authInformation) return;\n\t\tconst now = new Date();\n\t\tconst expiresIn = authInformation.expirationDate.getTime() - now.getTime();\n\t\tif (expiresIn > 0) {\n\t\t\tthis.AuthToken = authInformation.token;\n\t\t\tthis.IsAuthenticated = true;\n\t\t\tthis.userId = authInformation.userId;\n\t\t\tthis.authStatusListener.next(true);\n\t\t\tthis.setAuthTimer(expiresIn / 1000);\n\t\t\tconsole.log(expiresIn);\n\t\t}\n\t}\n\n\tprivate setAuthTimer(duration: number) {\n\t\tthis.tokenTimer = setTimeout(() => {\n\t\t\tthis.logOutUser();\n\t\t}, duration * 1000);\n\t\tconsole.log(\"Setting timer: \" + duration);\n\t}\n\n\tprivate saveAuthData(token: string, duration: Date, userId: string) {\n\t\tlocalStorage.setItem(\"token\", token);\n\t\tlocalStorage.setItem(\"expiration\", duration.toISOString());\n\t\tlocalStorage.setItem(\"userId\", userId);\n\t}\n\n\tprivate getAuthInfo() {\n\t\tconst token = localStorage.getItem(\"token\");\n\t\tconst expirationDate = localStorage.getItem(\"expiration\");\n\t\tconst userId = localStorage.getItem(\"userId\");\n\t\tif (!token || !expirationDate) {\n\t\t\treturn null;\n\t\t}\n\t\treturn {\n\t\t\ttoken: token,\n\t\t\texpirationDate: new Date(expirationDate),\n\t\t\tuserId: userId,\n\t\t};\n\t}\n\tprivate clearAuthData() {\n\t\tlocalStorage.removeItem(\"token\");\n\t\tlocalStorage.removeItem(\"expiration\");\n\t\tlocalStorage.removeItem(\"userId\");\n\t}\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}